<!-- TODO fix formEncounterType and encounterRole-->
<htmlform formUuid="68728aa6-4985-11e2-8815-657001b58a90" formName="Vitals" formEncounterType="1373cf95-06e8-468b-a3da-360ac1cf026d" formVersion="1.0">

    <!--
    Remaining Issues:
    * Summary shows temperature twice (once for hidden input)
    * Summary needs to show BP as 120 / 80
    *
    -->

    <style>
        #calculated-bmi {
            font-weight: bold;
            font-size: 1.4em;
        }
    </style>

    <ifMode mode="ENTER">
        <script type="text/javascript">
            var calculateBmi = function() {
                var wt = getLegalValue('weight.value');
                var ht = getLegalValue('height.value');
                var bmi = wt / (ht * ht);
                if (!wt || !ht || isNaN(bmi)) {
                    $j('#no-calculated-bmi').show();
                    $j('#calculated-bmi-wrapper').hide();
                } else {
                    $j('#no-calculated-bmi').hide();
                    $j('#calculated-bmi-wrapper').show();
                    $j('#calculated-bmi').html(bmi.toFixed(1));
                    $j('#hidden-calculated-bmi').val(bmi.toFixed(1));
                }
            };

            $j(function() {
                $j('#calculated-bmi-wrapper').hide();

                $j('#temperature-c-or-f').change(function() {
                    checkNumber(this, 'temperature-error', true, 25, 110);
                    if ($j(this).hasClass('legalValue')) {
                        var temp = $j('#temperature-c-or-f').val();
                        if (temp > 60) {
                            // fahrenheit
                            temp = (temp - 32) * 5 / 9;
                            temp = parseFloat(temp.toFixed(2)); // round to one digit after the decimal point
                            $j("#temperature-units-chosen").html("F");
                        } else {
                            $j("#temperature-units-chosen").html("C");
                        }
                        setValue('temperature_c.value', temp);
                    } else {
                        setValue('temperature_c.value', null);
                    }
                });

                getField('weight.value').change(calculateBmi);

                getField('height.value').change(calculateBmi);

            });
        </script>
    </ifMode>

    <div class="hidden" id="encounter-details" sectionTag="section" headerStyle="title" headerLabel="Encounter Details">
        <fieldset>
            <legend>When?</legend>

            <encounterDate default="now" showTime="true"/>
        </fieldset>

        <fieldset>
            <legend>Who?</legend>

            <encounterProviderAndRole default="currentUser" encounterRole="a0b03050-c99b-11e0-9572-0800200c9a66" required="true"/>
        </fieldset>

        <fieldset>
            <legend>Where?</legend>

            <encounterLocation default="SessionAttribute:emrContext.sessionLocationId"/>
        </fieldset>
    </div>

    <section id="vitals" sectionTag="section" headerStyle="title" headerLabel="Vitals">
        <fieldset>
            <legend>Temperature</legend>

            <ifMode mode="ENTER">
                <input type="text" size="3" id="temperature-c-or-f"/>
                <span class="error" style="display: none" id="temperature-error"></span>
                in C or F
                <span id="temperature-units-chosen"></span>
                <div class="hidden">
                    <obs conceptId="PIH:TEMPERATURE (C)" showUnits="true" id="temperature_c"/>
                </div>
            </ifMode>
            <ifMode mode="VIEW">
                <obs conceptId="PIH:TEMPERATURE (C)" showUnits="true" id="temperature_c"/>
            </ifMode>
        </fieldset>

        <fieldset>
            <legend>Blood Pressure</legend>

            <div class="left">
                <obs conceptId="PIH:SYSTOLIC BLOOD PRESSURE" id="bp_systolic"/>
            </div>
            /
            <div class="left">
                <obs conceptId="PIH:DIASTOLIC BLOOD PRESSURE" id="bp_diastolic"/>
            </div>
        </fieldset>

        <fieldset>
            <legend>Heart Rate</legend>

            <obs conceptId="PIH:PULSE" showUnits="true" id="heart_rate"/>
        </fieldset>

        <fieldset>
            <legend>Respiratory Rate</legend>

            <obs conceptId="PIH:RESPIRATORY RATE" showUnits="true" id="respiratory_rate"/>
        </fieldset>

        <fieldset>
            <legend>O2 Sat</legend>

            <obs conceptId="PIH:BLOOD OXYGEN SATURATION" showUnits="true" id="o2_sat"/>
        </fieldset>

        <fieldset>
            <legend>Height</legend>

            <obs conceptId="PIH:HEIGHT (M)" showUnits="true" id="height"/>
        </fieldset>

        <fieldset>
            <legend>Weight</legend>

            <obs conceptId="PIH:WEIGHT (KG)" showUnits="true" id="weight"/>
        </fieldset>

        <fieldset>
            <legend>BMI</legend>

            <input type="hidden" name="focus-in-bmi-question" id="hidden-calculated-bmi" />

            <span id="no-calculated-bmi">
                Record a weight and height, so we can calculate the BMI
            </span>
            <span id="calculated-bmi-wrapper">
                Patient's BMI is <span id="calculated-bmi"></span>
            </span>

            <br/><br/>

            Tab or Enter to continue
        </fieldset>
    </section>


    <ifMode mode="ENTER">
        <div id="confirmation">
            <span class="title">Confirm</span>
            <div id="confirmationQuestion">
                Confirm submission? <input type="submit" value="Yes" /> or <input type="button" value="No" />
            </div>
        </div>
    </ifMode>

    <submit/>

</htmlform>